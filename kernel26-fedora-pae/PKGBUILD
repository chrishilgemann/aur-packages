# Maintainer: Phillip Smith <fukawi2@NO-SPAM.gmail.com>
# http://github.com/fukawi2/aur-packages

pkgname='kernel26-fedora-pae'
pkgver=2.6.33.4
_FEDORA_RELEASE=95.fc13
pkgrel=1
url="http://www.kernel.org/"
pkgdesc="linux kernel and modules, compiled by Fedora with PAE supported. Release $_FEDORA_RELEASE"
arch=('i686')
license=('GPL2')
depends=('coreutils' 'module-init-tools' 'mkinitcpio>=0.5.15')
makedepends=('rpmextract')
backup=('etc/mkinitcpio.d/kernel26.preset')
provides=("kernel26=$pkgver" "kernel26-fedora-pae=$pkgver")
conflicts=('kernel24' 'kernel24-scsi' 'kernel26-scsi' 'kernel26' 'kernel26-fedora')
# We need to force the upgrade because the previous maintainer
# used the Fedora release number as the pkgrel number so we could
# never have more than one release of each PKGBUILD!
options=(force)
install="kernel26-fedora.install"
source=("http://kojipkgs.fedoraproject.org/packages/kernel/${pkgver}/${_FEDORA_RELEASE}/${CARCH}/kernel-PAE-${pkgver}-${_FEDORA_RELEASE}.${CARCH}.rpm"
        "kernel26-fedora.preset")
md5sums=('8a2d63606be804520933e848fa115eb7'
         'c8f559ad29f3bce277ed054d85878c40')

build() {
  msg "Nothing to compile for $pkgname"
}

package() {
	cd $pkgdir
  
	rpmextract.sh $srcdir/kernel-PAE-${pkgver}-${_FEDORA_RELEASE}.${CARCH}.rpm
  
	rm -rf $pkgdir/etc/ld.so.conf.d || return 1
	rm -rf $pkgdir/usr || return 1
  
	msg "Generating kernel26-fedora.kver..."
	_kernver=${pkgver}-${_FEDORA_RELEASE}.${CARCH}.PAE
	mkdir -p $pkgdir/etc/mkinitcpio.d/kernel26-fedora.kver <<EOT
	cat > $pkgdir/etc/mkinitcpio.d/kernel26-fedora.kver <<EOT
# DO NOT EDIT THIS FILE
ALL_kver='$_kernver'"
EOT
	
  # Install mkinitcpio files
	install -D -m644 $srcdir/kernel26-fedora.preset $pkgdir/etc/mkinitcpio.d/kernel26-fedora.preset || return 1
}

# vim:set ts=2 sw=2 et:
