# Maintainer: Phillip Smith <fukawi2@NO-SPAM.gmail.com>
# Maintainer: Matias Korhonen <webadmin@draco-vulgaris.net>
# Contributor: Dylon Edwards <deltaecho@archlinux.us>
pkgbase=backintime
pkgname=('backintime-common' 'backintime-gnome' 'backintime-kde4')
pkgver=0.9.26
pkgrel=3
pkgdesc="a simple backup system for Linux inspired from the Flyback project and TimeVault"
arch=('i686' 'x86_64')
url="http://backintime.le-web.org/"
license=('GPL')
depends=( 'python' 'rsync' 'dcron' )
replaces=('backintime')
conflicts=('backintime')
source=("http://backintime.le-web.org/download/${pkgbase}/${pkgbase}-${pkgver}_src.tar.gz")
md5sums=('8a53d1f757ccfa439754f4a8b9cb3e49')

build() {
  msg "Compiling COMMON components..."
  cd ${srcdir}/${pkgbase}-${pkgver}/common
	
	./configure || return 1
	
	make || return 1

  if [ `which gnome-session 2> /dev/null` ] ; then
		msg "Building the Gnome GUI"
		cd ${srcdir}/${pkgbase}-${pkgver}/gnome
		./configure || return 1
		make || return 1
  fi
  
  if [ `which kdeinit4 2> /dev/null` ] ; then
		msg "Building the KDE4 GUI"
		cd ${srcdir}/${pkgbase}-${pkgver}/kde4
		./configure || return 1
		make || return 1
  fi
}

package_backintime-common() {
	msg "Packaging COMMON components..."
  cd ${srcdir}/${pkgbase}-${pkgver}/common
	make DESTDIR=${pkgdir} install
}

package_backintime-gnome() {
  if [ `which gnome-session 2> /dev/null` ] ; then
	  msg "Packaging the Gnome GUI"
    depends=( ${depends[@]} 'backintime-common' 'pygtk' 'python-notify' 'gnome-python' 'meld' )
	  cd ${srcdir}/${pkgbase}-${pkgver}/gnome
    make DESTDIR=${pkgdir} install || return 1
  else
    msg "Gnome not found; Not packaging for Gnome"
  fi
}

package_backintime-kde4() {
  if [ `which kdeinit4 2> /dev/null` ] ; then
	  msg "Packaging the KDE4 GUI"
    depends=( ${depends[@]} 'backintime-common' 'xorg-utils' 'pyqt' 'kdebindings-python')
    cd ${srcdir}/${pkgbase}-${pkgver}/kde4
    make DESTDIR=${pkgdir} install || return 1
  else
    msg "KDE4 not found; Not packaging for KDE4"
  fi
}

# vim:set ts=2 sw=2 et:
