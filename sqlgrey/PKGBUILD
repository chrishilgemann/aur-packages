# Maintainer: Phillip Smith <fukawi2@NO-SPAM.gmail.com>
# http://github.com/fukawi2/aur-packages

### I AM ONLY THE PACKAGER, NOT THE DEVELOPER
### Please ask support questions about this software in one of:
###   1) The AUR comments; OR
###   2) Upstream forums/maillist etc; OR
###   3) The ArchLinux forums
### I do not always know enough about the software itself, or don't have the
### time to promptly respond to direct emails.
### If you have found a problem with the package/PKGBUILD (as opposed to
### the software) then please do email me or post an AUR comment.

pkgname=sqlgrey
pkgver=1.8.0
pkgrel=2
pkgdesc="Postfix greylisting policy service with auto-white-listing written in Perl with SQL database as storage backend. Greylisting stops 50 to 90 % junk mails (spam and virus) before they reach your Postfix server (saves BW, user time and CPU time)."
arch=('any')
url="http://sqlgrey.sourceforge.net/"
license=('GPL')
depends=('perl' 'perl-net-server' 'perl-io-multiplex' 'perl-dbi' 'perl-date-calc' 'postfix>=2.1')
optdepends=('perl-dbd-pg: for using postgresql as backend database'
            'perl-dbd-mysql: for using mysql as backend database')
backup=('etc/sqlgrey/sqlgrey.conf'
        'etc/sqlgrey/clients_ip_whitelist.local'
        'etc/sqlgrey/clients_fqdn_whitelist.local')
install=$pkgname.install
source=("http://downloads.sourceforge.net/project/sqlgrey/sqlgrey-1.8%20%28stable%29/$pkgname-$pkgver.tar.gz"
        'rc.sqlgrey'
        'systemd.sqlgrey'
        'clients_fqdn_whitelist.local'
        'clients_ip_whitelist.local')
md5sums=('de9c6d0740fd2589d4e353e76c40e2c7'
         '028c1b536ef89fa2eb6cbc7fb4708395'
         'b644c1e3e4fe9aba5ac40aaeb2b94b11'
         '235535e43def87509936e13f5a9bab44'
         '9ad7dd44af527e10674c79e511fc1dfc')

_UID=111
_GID=111

build() {
	cd $srcdir/$pkgname-$pkgver

	make
}

package() {
	cd $srcdir/$pkgname-$pkgver

  make ROOTDIR=${pkgdir} install
  
  # install sample config files
  install -Dm644 -o $UID -g $_GID $srcdir/clients_fqdn_whitelist.local $pkgdir/etc/sqlgrey/clients_fqdn_whitelist.local
  install -Dm644 -o $UID -g $_GID $srcdir/clients_ip_whitelist.local $pkgdir/etc/sqlgrey/clients_ip_whitelist.local

  # set permissions
  chown -R 111:111 $pkgdir/etc/sqlgrey

  # remove redundany init.d directory
  rm -Rf $pkgdir/etc/init.d

  # Install rc.d script
  install -D -m755 $srcdir/rc.$pkgname $pkgdir/etc/rc.d/$pkgname

  # install systemd "unit file"
  install -D -m755 $srcdir/systemd.sqlgrey $pkgdir/usr/lib/systemd/system/sqlgrey.service
}

# vim:set ts=2 sw=2 et:
